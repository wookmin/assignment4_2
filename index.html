<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìƒí’ˆ ê´€ë¦¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- ê³¼ì œ #2ì—ì„œ ì‚¬ìš©í•˜ë˜ ê³µìš© ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="my.css" />
  <!-- Bootstrap 5 CSS (ëª¨ë‹¬ìš©) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background-color: var(--bg, whitesmoke);
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
    }

    h1 {
      text-align: center;
      margin-bottom: 25px;
    }

    .wrap {
      max-width: 960px;
      margin: 0 auto;
      background: var(--card-bg, #fff);
      padding: 24px 28px;
      border-radius: 10px;
      box-shadow: var(--shadow, 0 4px 12px black);
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .toolbar-left {
      font-size: 13px;
      color: #555;
    }

    .badge {
      display: inline-block;
      padding: 3px 8px;
      font-size: 11px;
      border-radius: 999px;
      background: #eee;
      margin-left: 6px;
    }

    .btn {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background-color: var(--primary, skyblue);
      color: #fff;
      text-decoration: none;
    }
    .btn:hover {
      background-color: var(--primary-hover, skyblue);
    }
    .btn-gray {
      background-color: var(--gray, gray);
    }
    .btn-gray:hover {
      background-color: var(--gray-hover, darkgray);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 16px;
    }

    th, td {
      border: 1px solid var(--muted-border, whitesmoke);
      padding: 10px;
      font-size: 14px;
      text-align: left;
      background: #fff;
    }

    thead th {
      background: #f5f5f5;
      font-weight: 600;
    }

    td.num {
      text-align: right;
    }

    @media (max-width: 600px) {
      .wrap {
        padding: 20px 18px;
      }
      th, td {
        font-size: 13px;
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <h1>ìƒí’ˆ ê´€ë¦¬</h1>

  <div class="wrap">
    <!-- ìƒë‹¨ íˆ´ë°” -->
    <div class="toolbar">
      <div class="toolbar-left">
        <strong>API:</strong>
        <code id="apiUrlText"></code>
        <span class="badge">mockapi</span>
      </div>
      <div>
        <button id="openCreateBtn" class="btn" type="button">ìƒí’ˆ ì¶”ê°€</button>
        <button id="reloadBtn" class="btn btn-gray" type="button">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
      </div>
    </div>

    <!-- ëª©ë¡ í…Œì´ë¸” -->
    <table aria-label="ìƒí’ˆ ëª©ë¡">
      <thead>
        <tr>
          <th style="width:60px;">ID</th>
          <th>ìƒí’ˆëª…</th>
          <th>í’ˆëª©</th>
          <th style="width:120px;">ê°€ê²©(â‚©)</th>
          <th style="width:100px;">ìˆ˜ëŸ‰</th>
          <th style="width:160px;">ë™ì‘</th>
        </tr>
      </thead>
      <tbody id="productTbody">
        <!-- JSë¡œ ë Œë”ë§ -->
      </tbody>
    </table>
  </div>

  <!-- âœ… ëª¨ë‹¬: ì¶”ê°€/ìˆ˜ì • ê³µìš© -->
  <div
    class="modal fade"
    id="productModal"
    tabindex="-1"
    aria-labelledby="productModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="productForm">
          <div class="modal-header">
            <h5 class="modal-title" id="productModalLabel">ìƒí’ˆ ì¶”ê°€</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
          </div>
          <div class="modal-body">
            <!-- ìˆ˜ì • ì‹œ ì‚¬ìš©í•  hidden id -->
            <input type="hidden" id="productId" />

            <div class="mb-3">
              <label for="productName" class="form-label">ìƒí’ˆëª… *</label>
              <input
                type="text"
                id="productName"
                class="form-control"
                placeholder="ì˜ˆ) ë¬´ì„  ì´ì–´í° A1"
                required
              />
            </div>

            <div class="mb-3">
              <label for="productCategory" class="form-label">í’ˆëª© *</label>
              <input
                type="text"
                id="productCategory"
                class="form-control"
                placeholder="ì˜ˆ) ì „ìê¸°ê¸°"
                required
              />
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label for="productPrice" class="form-label">ê°€ê²©(â‚©) *</label>
                <input
                  type="number"
                  id="productPrice"
                  class="form-control"
                  min="0"
                  step="1"
                  placeholder="ì˜ˆ) 79000"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="productQuantity" class="form-label">ìˆ˜ëŸ‰ *</label>
                <input
                  type="number"
                  id="productQuantity"
                  class="form-control"
                  min="0"
                  step="1"
                  placeholder="ì˜ˆ) 25"
                  required
                />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-gray"
              data-bs-dismiss="modal"
            >
              ì·¨ì†Œ
            </button>
            <button type="submit" class="btn" id="saveBtn">
              ì €ì¥
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5 JS (ëª¨ë‹¬ ë™ì‘ìš©) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ===== ì„¤ì •ê°’ =====
    // ğŸ‘‰ ì—¬ê¸° BASE_URLë§Œ ë„¤ mockapi ì£¼ì†Œë¡œ ë§ì¶”ë©´ ë¼
    const BASE_URL = "https://6918280021a96359486eeaad.mockapi.io/products";

    const tbody = document.getElementById("productTbody");
    const form = document.getElementById("productForm");
    const idInput = document.getElementById("productId");
    const nameInput = document.getElementById("productName");
    const categoryInput = document.getElementById("productCategory");
    const priceInput = document.getElementById("productPrice");
    const quantityInput = document.getElementById("productQuantity");
    const saveBtn = document.getElementById("saveBtn");
    const reloadBtn = document.getElementById("reloadBtn");
    const openCreateBtn = document.getElementById("openCreateBtn");
    const apiUrlText = document.getElementById("apiUrlText");
    apiUrlText.textContent = BASE_URL;

    const productModalEl = document.getElementById("productModal");
    const productModal = new bootstrap.Modal(productModalEl);

    // ìˆ«ì í¬ë§·
    function formatNumber(n) {
      return Number(n).toLocaleString("ko-KR");
    }

    // ===== ëª©ë¡ í…Œì´ë¸” ê·¸ë¦¬ê¸° =====
    function renderTable(products) {
      tbody.innerHTML = "";

      if (!products || products.length === 0) {
        tbody.innerHTML =
          '<tr><td colspan="6" style="text-align:center; color:#777;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      products.forEach(function (p) {
        const tr = document.createElement("tr");

        const tdId = document.createElement("td");
        tdId.textContent = p.id;
        tdId.className = "num";

        const tdName = document.createElement("td");
        tdName.textContent = p.name;

        const tdCategory = document.createElement("td");
        tdCategory.textContent = p.category;

        const tdPrice = document.createElement("td");
        tdPrice.textContent = formatNumber(p.price);
        tdPrice.className = "num";

        const tdQuantity = document.createElement("td");
        tdQuantity.textContent = p.quantity;
        tdQuantity.className = "num";

        const tdActions = document.createElement("td");

        const editBtn = document.createElement("button");
        editBtn.type = "button";
        editBtn.textContent = "ìˆ˜ì •";
        editBtn.className = "btn";
        editBtn.style.padding = "6px 10px";
        editBtn.style.fontSize = "12px";
        editBtn.addEventListener("click", function () {
          fillFormForEdit(p);
        });

        const delBtn = document.createElement("button");
        delBtn.type = "button";
        delBtn.textContent = "ì‚­ì œ";
        delBtn.className = "btn btn-gray";
        delBtn.style.padding = "6px 10px";
        delBtn.style.fontSize = "12px";
        delBtn.style.marginLeft = "6px";
        delBtn.addEventListener("click", function () {
          deleteProduct(p.id);
        });

        tdActions.appendChild(editBtn);
        tdActions.appendChild(delBtn);

        tr.appendChild(tdId);
        tr.appendChild(tdName);
        tr.appendChild(tdCategory);
        tr.appendChild(tdPrice);
        tr.appendChild(tdQuantity);
        tr.appendChild(tdActions);

        tbody.appendChild(tr);
      });
    }

    // ===== GET: ëª©ë¡ ì¡°íšŒ =====
    function loadProducts() {
      const xhr = new XMLHttpRequest();
      xhr.open("GET", BASE_URL);
      xhr.setRequestHeader("content-type", "application/json");
      xhr.send();

      xhr.onload = function () {
        if (xhr.status === 200) {
          const res = JSON.parse(xhr.responseText);
          renderTable(res);
        } else {
          console.log(xhr.status, xhr.statusText);
          alert("ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆì–´.");
        }
      };
    }

    // ===== í¼ ì´ˆê¸°í™” =====
    function resetForm() {
      idInput.value = "";
      nameInput.value = "";
      categoryInput.value = "";
      priceInput.value = "";
      quantityInput.value = "";
      saveBtn.textContent = "ì €ì¥";
    }

    // ===== ëª¨ë‹¬: ì¶”ê°€ ëª¨ë“œë¡œ ì—´ê¸° =====
    function openCreateModal() {
      resetForm();
      document.getElementById("productModalLabel").textContent = "ìƒí’ˆ ì¶”ê°€";
      productModal.show();
    }

    // ===== í¼ì„ ìˆ˜ì • ëª¨ë“œë¡œ ì±„ìš°ê³  ëª¨ë‹¬ ì—´ê¸° =====
    function fillFormForEdit(product) {
      idInput.value = product.id;
      nameInput.value = product.name;
      categoryInput.value = product.category;
      priceInput.value = product.price;
      quantityInput.value = product.quantity;
      saveBtn.textContent = "ìˆ˜ì • ì™„ë£Œ";
      document.getElementById("productModalLabel").textContent = "ìƒí’ˆ ìˆ˜ì •";
      productModal.show();
    }

    // ===== POST: ìƒˆ ë°ì´í„° ì¶”ê°€ =====
    function createProduct(payload) {
      const xhr = new XMLHttpRequest();
      xhr.open("POST", BASE_URL);
      xhr.setRequestHeader("content-type", "application/json");
      xhr.send(JSON.stringify(payload));

      xhr.onload = function () {
        if (xhr.status === 201 || xhr.status === 200) {
          alert("ìƒí’ˆì´ ì¶”ê°€ë˜ì—ˆì–´.");
          productModal.hide();
          loadProducts();
        } else {
          console.log(xhr.status, xhr.statusText);
          alert("ìƒí’ˆ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆì–´.");
        }
      };
    }

    // ===== PUT: ê¸°ì¡´ ë°ì´í„° ìˆ˜ì • =====
    function updateProduct(id, payload) {
      const xhr = new XMLHttpRequest();
      xhr.open("PUT", BASE_URL + "/" + encodeURIComponent(id));
      xhr.setRequestHeader("content-type", "application/json");
      xhr.send(JSON.stringify(payload));

      xhr.onload = function () {
        if (xhr.status === 200) {
          alert("ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆì–´.");
          productModal.hide();
          loadProducts();
        } else {
          console.log(xhr.status, xhr.statusText);
          alert("ìƒí’ˆ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆì–´.");
        }
      };
    }

    // ===== DELETE: ë°ì´í„° ì‚­ì œ =====
    function deleteProduct(id) {
      if (!confirm("ID " + id + "ë²ˆ ìƒí’ˆì„ ì‚­ì œí• ê¹Œ?")) return;

      const xhr = new XMLHttpRequest();
      xhr.open("DELETE", BASE_URL + "/" + encodeURIComponent(id));
      xhr.send();

      xhr.onload = function () {
        if (xhr.status === 200 || xhr.status === 204) {
          alert("ì‚­ì œë˜ì—ˆì–´.");
          loadProducts();
        } else {
          console.log(xhr.status, xhr.statusText);
          alert("ìƒí’ˆ ì‚­ì œì— ì‹¤íŒ¨í–ˆì–´.");
        }
      };
    }

    // ===== í¼ submit ì´ë²¤íŠ¸ (ì¶”ê°€/ìˆ˜ì • ê³µìš©, ëª¨ë‹¬ ì•ˆì—ì„œ ë™ì‘) =====
    function handleFormSubmit(e) {
      e.preventDefault();

      const name = nameInput.value.trim();
      const category = categoryInput.value.trim();
      const price = Number(priceInput.value);
      const quantity = Number(quantityInput.value);

      if (name.length < 2) {
        alert("ìƒí’ˆëª…ì€ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì¤˜.");
        nameInput.focus();
        return;
      }
      if (!category) {
        alert("í’ˆëª©ì„ ì…ë ¥í•´ì¤˜.");
        categoryInput.focus();
        return;
      }
      if (!Number.isInteger(price) || price < 0) {
        alert("ê°€ê²©ì€ 0 ì´ìƒ ì •ìˆ˜ë¡œ ì…ë ¥í•´ì¤˜.");
        priceInput.focus();
        return;
      }
      if (!Number.isInteger(quantity) || quantity < 0) {
        alert("ìˆ˜ëŸ‰ì€ 0 ì´ìƒ ì •ìˆ˜ë¡œ ì…ë ¥í•´ì¤˜.");
        quantityInput.focus();
        return;
      }

      const id = idInput.value;
      const payload = {
        name: name,
        category: category,
        price: price,
        quantity: quantity
      };

      if (id) {
        updateProduct(id, payload);
      } else {
        createProduct(payload);
      }
    }

    // ===== window.onload: ì´ë²¤íŠ¸ ì—°ê²° =====
    window.onload = function () {
      reloadBtn.addEventListener("click", loadProducts);
      openCreateBtn.addEventListener("click", openCreateModal);
      form.addEventListener("submit", handleFormSubmit);
      loadProducts();
    };
  </script>
</body>
</html>
